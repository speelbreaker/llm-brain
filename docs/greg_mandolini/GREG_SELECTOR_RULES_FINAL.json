{
  "meta": {
    "module": "ENTRY_ENGINE",
    "version": "8.0-Diamond-Polished",
    "description": "Determines Market Regime and selects the optimal Strategy Type. DOES NOT MANAGE POSITIONS.",
    "bot_name": "Magadini_VRP_Harvester",
    "market_type": "Deribit_Cash_Settled",
    "author_style": "Quantitative_Vol_Selling_&_Accumulation"
  },

  "global_entry_filters": {
    "allowed_dte_range": {
      "standard": {"min": 25, "max": 45},
      "calendar_exception": {"front_leg_min": 7, "front_leg_max": 14},
      "spread_exception": {"min": 20, "max": 35}
    },
    "calibration": {
      "skew_neutral_threshold": 4.0,
      "min_vrp_floor": 0.0,
      "min_vrp_directional": 2.0,
      "rsi_thresholds": {
        "lower": 30,
        "upper": 70
      },
      "safety_adx_high": 35.0,
      "safety_chop_high": 0.85,
      "straddle_vrp_min": 15.0,
      "straddle_adx_max": 20.0,
      "straddle_chop_max": 0.6,
      "strangle_vrp_min": 10.0,
      "strangle_adx_max": 30.0,
      "strangle_chop_max": 0.8,
      "calendar_term_spread_min": 5.0,
      "calendar_front_rv_iv_ratio_max": 0.8,
      "calendar_vrp_7d_min": 5.0,
      "iron_fly_iv_rank_min": 0.80,
      "iron_fly_vrp_min": 10.0
    }
  },

  "sensors": {
    "volatility_metrics": {
      "vrp_30d": "Implied_Vol_30d - Realized_Vol_30d",
      "vrp_7d": "Implied_Vol_7d - Realized_Vol_7d",
      "front_rv_iv_ratio": "Realized_Vol_7d / Implied_Vol_7d",
      "chop_factor_7d": "Realized_Vol_7d / Implied_Vol_30d",
      "iv_rank_6m": "(Current_IV - 6m_Low) / (6m_High - 6m_Low)",
      "term_structure_spread": "Implied_Vol_7d - Implied_Vol_30d",
      "skew_25d": "Implied_Vol_25d_Put - Implied_Vol_25d_Call"
    },
    "trend_metrics": {
      "adx_14d": "Average_Directional_Index",
      "rsi_14d": "Relative_Strength_Index",
      "price_vs_ma200": "Current_Price - MA_200d",
      "predicted_funding_rate": "Predicted_Perp_Funding_Rate"
    }
  },

  "decision_waterfall": [
    {
      "step": 1,
      "name": "SAFETY_FILTER",
      "condition": "adx_14d > safety_adx_high OR chop_factor_7d > safety_chop_high",
      "outcome": "NO_TRADE",
      "reasoning": "Trend too strong or Realized Vol is matching Implied Vol."
    },
    {
      "step": 2,
      "name": "CALENDAR_CHECK",
      "condition": "term_structure_spread > calendar_term_spread_min AND front_rv_iv_ratio < calendar_front_rv_iv_ratio_max AND vrp_7d > calendar_vrp_7d_min",
      "outcome": "STRATEGY_B_CALENDAR",
      "reasoning": "Front-end event pricing detected with favorable RV/IV ratio."
    },
    {
      "step": 3,
      "name": "EXTREME_VOL_CHECK",
      "condition": "iv_rank_6m > iron_fly_iv_rank_min AND vrp_30d > iron_fly_vrp_min",
      "outcome": "STRATEGY_D_IRON_BUTTERFLY",
      "reasoning": "Vol is too high for naked exposure. Defined risk only."
    },
    {
      "step": 4,
      "name": "STRADDLE_CHECK",
      "condition": "vrp_30d > straddle_vrp_min AND chop_factor_7d < straddle_chop_max AND adx_14d < straddle_adx_max AND ABS(skew_25d) < skew_neutral_threshold",
      "outcome": "STRATEGY_A_STRADDLE",
      "reasoning": "High premium, low realized movement, neutral skew."
    },
    {
      "step": 5,
      "name": "STRANGLE_CHECK",
      "condition": "vrp_30d >= strangle_vrp_min AND chop_factor_7d < strangle_chop_max AND adx_14d < strangle_adx_max AND ABS(skew_25d) < skew_neutral_threshold",
      "outcome": "STRATEGY_A_STRANGLE",
      "reasoning": "Good edge, market drifting, neutral skew. Strangle accommodates drift."
    },
    {
      "step": 6,
      "name": "ACCUMULATION_CHECK",
      "condition": "skew_25d > skew_neutral_threshold AND price_vs_ma200 > 0 AND vrp_30d > min_vrp_directional",
      "outcome": "STRATEGY_C_SHORT_PUT",
      "reasoning": "Bullish trend, expensive Puts. Paid to buy."
    },
    {
      "step": 7,
      "name": "DIRECTIONAL_SPREAD_CHECK",
      "branches": [
        {
          "condition": "skew_25d > skew_neutral_threshold AND rsi_14d < rsi_thresholds.lower AND vrp_30d > min_vrp_directional",
          "outcome": "STRATEGY_F_BULL_PUT_SPREAD",
          "reasoning": "Oversold + Fear Skew with positive VRP."
        },
        {
          "condition": "skew_25d < (skew_neutral_threshold * -1) AND rsi_14d > rsi_thresholds.upper AND vrp_30d > min_vrp_directional",
          "outcome": "STRATEGY_F_BEAR_CALL_SPREAD",
          "reasoning": "Overbought + FOMO Skew with positive VRP."
        }
      ]
    },
    {
      "step": 8,
      "name": "DEFAULT",
      "outcome": "NO_TRADE",
      "reasoning": "No valid setup found."
    }
  ],

  "strategy_definitions": {
    "STRATEGY_A_STRADDLE": {
      "structure": "Sell ATM Call + Sell ATM Put",
      "target_dte": "30-45 days",
      "management": {
        "hedge_mode": "DYNAMIC_DELTA",
        "hedge_trigger": "Net_Delta > |0.10|",
        "close_profit": "50% of credit",
        "close_stop": "200% of credit OR IV expands > 10 points",
        "expiry_rule": "HARD_CLOSE_24H_BEFORE_EXPIRY"
      }
    },
    "STRATEGY_A_STRANGLE": {
      "structure": "Sell 15-Delta Call + Sell 15-Delta Put",
      "target_dte": "30-45 days",
      "management": {
        "hedge_mode": "DYNAMIC_DELTA",
        "hedge_trigger": "Net_Delta > |0.12|",
        "close_profit": "50% of credit",
        "close_stop": "200% of credit",
        "expiry_rule": "HARD_CLOSE_24H_BEFORE_EXPIRY"
      }
    },
    "STRATEGY_B_CALENDAR": {
      "structure": "Sell ATM (7-14 DTE) + Buy ATM (30-45 DTE)",
      "management": {
        "hedge_mode": "LIGHT_DELTA",
        "hedge_trigger": "Net_Delta > |0.20|",
        "close_profit": "Front_IV < Back_IV OR 25% ROC",
        "close_stop": "Price moves > 5% from strike OR Loss > 100% of Debit",
        "expiry_rule": "Close Short Leg 24h before expiry"
      }
    },
    "STRATEGY_C_SHORT_PUT": {
      "structure": "Sell 20-25 Delta Put",
      "target_dte": "30-45 days",
      "notes": "Requires 100% Cash Collateral for Strike. True accumulation / bullish VRP.",
      "management": {
        "hedge_mode": "NONE",
        "close_profit": "70% of credit",
        "close_stop": "ABS(Option_Delta) > 0.80",
        "expiry_rule": {
          "condition": "ITM at expiry",
          "want_ownership": true,
          "actions": {
            "if_predicted_funding_gte_0": "Buy Perp (Synthetic Assignment)",
            "if_predicted_funding_lt_0": "Buy Spot to avoid funding bleed"
          }
        }
      }
    },
    "STRATEGY_D_IRON_BUTTERFLY": {
      "structure": "Sell ATM Straddle + Buy Wings at 10-Delta",
      "target_dte": "30-45 days",
      "management": {
        "hedge_mode": "LOOSE_DELTA",
        "close_profit": "40% of max profit",
        "close_stop": "Price touches Wing Strikes OR 200% of Credit",
        "expiry_rule": "HARD_CLOSE_24H_BEFORE_EXPIRY"
      }
    },
    "STRATEGY_F_BULL_PUT_SPREAD": {
      "structure": "Sell 25-Delta Put + Buy 10-Delta Put",
      "target_dte": "20-35 days",
      "management": {
        "hedge_mode": "NONE",
        "close_profit": "60% of max profit",
        "close_stop": "Loss > 200% of Credit Received",
        "expiry_rule": "Close if ITM"
      }
    },
    "STRATEGY_F_BEAR_CALL_SPREAD": {
      "structure": "Sell 25-Delta Call + Buy 10-Delta Call",
      "target_dte": "20-35 days",
      "management": {
        "hedge_mode": "NONE",
        "close_profit": "60% of max profit",
        "close_stop": "Loss > 200% of Credit Received",
        "expiry_rule": "Close if ITM"
      }
    }
  },

  "black_swan_protocol": {
    "trigger": "Crypto_Market_Cap_Change_24h < -10%",
    "actions": {
      "SHORT_VOL_STRATEGIES (A, B, D, F)": "CLOSE_IMMEDIATELY_AT_MARKET",
      "ACCUMULATION_STRATEGY (C)": "HOLD_AND_MONITOR",
      "notes": "For Strategy C: Verify account Health > 1.2. If Health < 1.2, Close C to preserve solvency."
    },
    "execution_note": "Black swan conditions allow MARKET_ORDERS per execution_protocol.black_swan_override"
  }
}
