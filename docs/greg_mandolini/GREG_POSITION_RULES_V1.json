{
  "meta": {
    "module": "POSITION_ENGINE",
    "version": "1.1-Greg-Management-with-Hedging",
    "description": "Management rules for open Greg strategies including delta hedging. These rules evaluate open positions and suggest hedge, profit-taking, stop-loss, roll, or assignment actions."
  },

  "global_definitions": {
    "net_delta_calculation": "Sum(Option_Deltas) + Sum(Perp_Deltas)",
    "hedge_instrument": {
      "BTC": "BTC-PERPETUAL",
      "ETH": "ETH-PERPETUAL"
    },
    "perp_delta_per_contract": 1.0,
    "hedge_check_frequency_seconds": 60,
    "hedge_on_price_move_pct": 0.01
  },

  "calibration": {
    "straddle_delta_threshold": 0.15,
    "strangle_delta_threshold": 0.20,
    "calendar_delta_threshold": 0.20,
    "iron_fly_delta_threshold": 0.25,
    "straddle_profit_take_pct": 0.50,
    "strangle_profit_take_pct": 0.50,
    "straddle_stop_loss_multiple": 2.0,
    "strangle_stop_loss_multiple": 2.0,
    "straddle_close_at_dte": 21,
    "strangle_close_at_dte": 21,

    "calendar_price_move_stop_pct": 0.05,
    "calendar_close_front_leg_hours": 24,

    "short_put_profit_take_pct": 0.70,
    "short_put_stop_delta_abs": 0.80,

    "iron_fly_profit_take_pct": 0.30,

    "spread_profit_take_pct": 0.60
  },

  "strategies": {
    "STRATEGY_A_STRADDLE": {
      "type": "short_straddle",
      "display_name": "ATM Straddle (Strategy A)",
      "hedge": {
        "mode": "DYNAMIC_DELTA",
        "delta_abs_threshold": 0.15,
        "check_frequency": "60s or price_move > 1%",
        "target_delta": 0.0,
        "action": "Open Perp Position to restore Net_Delta to 0.0"
      },
      "profit_target": {
        "type": "credit_pct",
        "threshold": 0.50,
        "description": "Close when 50% of credit received is profit"
      },
      "stop_loss": {
        "type": "loss_multiple_of_credit",
        "multiple": 2.0,
        "description": "Close if loss exceeds 2x the initial credit"
      },
      "expiry_rule": {
        "close_at_dte": 21,
        "description": "Close or roll when DTE drops below 21 days"
      }
    },

    "STRATEGY_A_STRANGLE": {
      "type": "short_strangle",
      "display_name": "ATM Strangle (Strategy A)",
      "hedge": {
        "mode": "DYNAMIC_DELTA",
        "delta_abs_threshold": 0.20,
        "check_frequency": "60s or price_move > 1%",
        "target_delta": 0.0,
        "action": "Open Perp Position to restore Net_Delta to 0.0"
      },
      "profit_target": {
        "type": "credit_pct",
        "threshold": 0.50,
        "description": "Close when 50% of credit received is profit"
      },
      "stop_loss": {
        "type": "loss_multiple_of_credit",
        "multiple": 2.0,
        "description": "Close if loss exceeds 2x the initial credit"
      },
      "expiry_rule": {
        "close_at_dte": 21,
        "description": "Close or roll when DTE drops below 21 days"
      }
    },

    "STRATEGY_B_CALENDAR": {
      "type": "calendar_spread",
      "display_name": "Calendar Spread (Strategy B)",
      "hedge": {
        "mode": "LIGHT_DELTA",
        "delta_abs_threshold": 0.20,
        "check_frequency": "Hourly",
        "target_delta": 0.0,
        "action": "Open Perp Position to nudge Net_Delta toward 0"
      },
      "profit_target": {
        "type": "front_vs_back_iv",
        "description": "Close when front IV collapses vs back IV (event premium crushed)"
      },
      "stop_loss": {
        "type": "price_move_pct",
        "threshold": 0.05,
        "description": "Close if price moves more than 5% away from strike (tent breach)"
      },
      "expiry_rule": {
        "close_front_leg_hours_before_expiry": 24,
        "description": "Close both legs when front leg is within 24 hours of expiry"
      }
    },

    "STRATEGY_C_SHORT_PUT": {
      "type": "short_put_accumulation",
      "display_name": "Short Put Accumulation (Strategy C)",
      "hedge": {
        "mode": "NONE",
        "description": "No delta hedging - accumulation strategy accepts directional exposure"
      },
      "profit_target": {
        "type": "credit_pct",
        "threshold": 0.70,
        "description": "Close when 70% of credit received is profit"
      },
      "stop_loss": {
        "type": "delta_abs",
        "threshold": 0.80,
        "description": "Consider assignment or roll when delta exceeds 0.80"
      },
      "assignment": {
        "mode": "funding_conditional",
        "description": "If funding >= 0 use perp (synthetic assignment), else use spot"
      },
      "expiry_rule": null
    },

    "STRATEGY_D_IRON_BUTTERFLY": {
      "type": "iron_fly",
      "display_name": "Iron Butterfly (Strategy D)",
      "hedge": {
        "mode": "LOOSE_DELTA",
        "delta_abs_threshold": 0.25,
        "check_frequency": "Hourly",
        "target_delta": 0.0,
        "action": "Light hedge only when delta exceeds 0.25"
      },
      "profit_target": {
        "type": "max_profit_pct",
        "threshold": 0.30,
        "description": "Close when 30% of max profit is realized"
      },
      "stop_loss": {
        "type": "touch_wing",
        "description": "Close if underlying price touches either long wing strike"
      },
      "expiry_rule": null
    },

    "STRATEGY_F_BULL_PUT_SPREAD": {
      "type": "credit_spread_bull_put",
      "display_name": "Bull Put Spread (Strategy F)",
      "hedge": {
        "mode": "NONE",
        "description": "No hedging - directional strategy"
      },
      "profit_target": {
        "type": "max_profit_pct",
        "threshold": 0.60,
        "description": "Close when 60% of max profit is realized"
      },
      "stop_loss": {
        "type": "touch_short_strike",
        "description": "Close if underlying price touches the short strike"
      },
      "expiry_rule": null
    },

    "STRATEGY_F_BEAR_CALL_SPREAD": {
      "type": "credit_spread_bear_call",
      "display_name": "Bear Call Spread (Strategy F)",
      "hedge": {
        "mode": "NONE",
        "description": "No hedging - directional strategy"
      },
      "profit_target": {
        "type": "max_profit_pct",
        "threshold": 0.60,
        "description": "Close when 60% of max profit is realized"
      },
      "stop_loss": {
        "type": "touch_short_strike",
        "description": "Close if underlying price touches the short strike"
      },
      "expiry_rule": null
    }
  }
}
